# 1. 文件物理结构（文件分配方式）
用户通过逻辑地址来操作自己的文件，操作系统负责实现从逻辑地址到物理地址的映射
## 1.1 连续分配
在FCB（文件控制块，可以理解为文件目录表项）中需要记录**起始块号**和**长度**。每个文件在磁盘占有一组连续的块，支持顺序访问和直接访问（随机访问），顺序读写时速度最快。但是**不方便连续扩展**，且存储空间利用率低，会**产生难以利用的磁盘碎片**

## 1.2 链接分配-隐式链接
在FCB中需要记录**起始块号**和**结束块号**，各个块中都会保存指向下一个盘块的指针，这些指针对用户是透明的。只支持顺序访问，不支持随机访问，查找效率低。但是很**方便扩展**。

## 1.3 链接分配-显示链接
FCB只需要记录**起始块号**，建立一张FAT（文件分配表，一个磁盘对应一张），存放各物理块指向的物理块的指针，**常驻内存**。采用链式分配（显式链接）方式的文件，支持顺序访问，也支持随机访问（访问I号时不需要访问0~i-1号逻辑块），地址转换时不需要访问磁盘，文件的访问效率更高，也**不会产生外部碎片，方便扩展**。

## 1.4 索引分配
FCB中记录**索引块号**，系统为每个文件建立一张索引表，索引表中记录文件的各个逻辑块对应的物理块。支持随机访问，并且方便实现文件扩展。
如果文件太大，一个磁盘块装不下文件的整张索引表
### 1.4.1 链接方案
索引块中记录指向下一个索引块的指针，但是文件太大的话，查找最后一个逻辑块的效率很低
### 1.4.2 多层索引
建立多层索引（类似多级页表），各层索引表大小不能超过一个磁盘块，采用K层索引结构，且顶层索引表未调入内存，则访问一次数据块需要K+1次读磁盘操作。
### 1.4.3 混合索引
既包含**直接地址索引**（直接指向数据块，读两次），又包含**一级间接索引**（单层索引表，读三次）、还包含**两级间接索引**（指向两层索引表，读四次）

# 2.文件存储空间管理
存储空间的划分：将物理磁盘划分为一个个文件卷（逻辑卷、逻辑盘），有的系统支持超大型文件，可支持右多个物理磁盘组成一个文件卷

## 2.1 存储空间管理--空闲表法
适用于“连续分配方式”，记录**第一个空闲盘块号**和**空闲盘块数**，回收的时候主要表项的**合并问题**

## 2.2 存储空间管理--空闲链表法
盘块指一个物理存储块，盘区指多个盘块相连的区域。
1. 空闲盘块链：以盘块为结点组成空闲链，系统保存链头、链尾指针。分配：从链头开始依次摘下。回收：回收的盘块依次挂到链尾
2. 空闲盘区链：以盘区为结点组成空闲链，保存链头、链尾指针。分配：从链头开始检索，找到大小符合要求的空闲盘区（可以离散）。回收：若没有空闲盘区相邻，在链尾创建新的空闲盘区，否则并入。

## 2.3 存储空间管理--位示图法
位示图：每个二进制位对应一个盘块，其值0表示空闲，1表示分配。构建一个二维的二进制表，横轴表示位号，纵轴表示字号，即可更具字号和位号求出对应的盘块号

## 2.4 存储空间管理--成组链接法
空闲表法、空闲链表法不适用于大型文件系统。在UNIX中用来成组链接法。
文件卷的**目录区**中专门用一个磁盘块作为**超级块**，当系统启动时需要把**超级块读入内存**，并且保证内存和外存的超级块数据一致。
在超级块中保存了下一组**空闲盘块数**和**空闲块号**（空闲块号不需要连续）。每个分块的**第一个空闲块**保存下一组分块信息

# 3.磁盘的物理地址
可以用 **柱面号、盘面号、扇区号**来决定任意一个“磁盘块”

## 3.1磁盘调度算法

### 3.1.1 先来先服务算法（FCFS）
按照请求的先后顺序进行调度。

### 3.1.2 最短寻找时间优先（SSTF）
找距离当前磁头最近的磁道，选择眼前最优，但是总体未必最优，可能会产生**饥饿**现象，导致磁头在一个小区域来来回回。

### 3.1.3 扫描算法（SCAN）
也叫电梯算法，只有磁头扫描到一边才能往另一边移动。解决了**饥饿**现象。但是有两个缺点，1）只有到达最边上的磁道才能改变移动方向。2）对各个位置磁道的响应频率不平均。

### 3.1.4 LOOK调度算法
解决 SCAN 的第一个问题，如果磁头移动方向上已经没有别的请求，就可以立即改变磁头移动方向

### 3.1.5 循环扫描算法（C-SCAN）
为了解决 SCAN 的第二个问题，在返回到另一边的时候直接快速移动到起始端，不处理中间的任何请求

### 3.1.6 C-LOOK 调度算法
为了同时解决 SCAN 的两个问题，在 C-SCAN 中如果移动方向上没有请求，则直接回到起始端开始扫描
